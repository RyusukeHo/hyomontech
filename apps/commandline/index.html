<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="apple-touch-icon" type="image/png" href="apple-touch-icon-180x180.png">
    <link rel="icon" href="favicon.ico">

    <title>Command Line</title>
</head>

<body>
    <div class="container"><iframe
            src="https://script.google.com/macros/s/AKfycbz7pEBocJ3zOGfEr-t3Ib6Kp5TZaZv2hpE2iDVBmNZW4eUkKkx1eskbWKjZIYmcZZAZPg/exec"
            frameborder="0" id="page"></iframe></div>


    <style>
        * {
            margin: 0;
            padding: 0;
            overflow: hidden;
            height: 100vh;
        }

        iframe {
            border: none;
            width: 100%;
            height: 100%;
        }
    </style>
    <script>
        let appPath = "https://script.google.com/macros/s/AKfycbz7pEBocJ3zOGfEr-t3Ib6Kp5TZaZv2hpE2iDVBmNZW4eUkKkx1eskbWKjZIYmcZZAZPg/exec";
        let frame = document.getElementById("page");
        function getCookie(cookieName) {
            let name = cookieName + "=";
            let decodedCookie = decodeURIComponent(document.cookie);
            let cookieArray = decodedCookie.split(';');

            for (let i = 0; i < cookieArray.length; i++) {
                let cookie = cookieArray[i].trim();
                if (cookie.indexOf(name) == 0) {
                    return cookie.substring(name.length, cookie.length);
                }
            }

            // 指定されたクッキーが見つからない場合「null」を返す
            return null;
        }
        checkLogin();
        async function checkLogin() {
            if (getCookie("id") == null) {
                frame.src = "https://ryusukeho.github.io/hyomontech/login/?redirect=" + appPath;
            } else {
                const data = {
                    "type": "login",
                    "id": decodeURIComponent(getCookie("id")),
                    "password": decodeURIComponent(getCookie("password"))
                };

                const options = {
                    'method': 'post',
                    'headers': {
                    },
                    'body': JSON.stringify(data)
                };
                let res = await fetch("https://script.google.com/macros/s/AKfycbwzB6H3Wy_V1MK_TMSkxBi3Kusz2MBEtuRkphpA7w9DKS9ApQOcaO-HH-Yh8mtEmQxy/exec", options);
                let obj = await res.json();
                if (obj.code == "Success") {
                    frame.contentWindow.postMessage(JSON.stringify(obj), appPath);
                } else {
                    frame.src = "https://ryusukeho.github.io/hyomontech/login/?redirect=" + appPath;
                }
            }
        }

    </script>
</body>

</html>